version: "3"

services:
    zookeeper:
        image: confluentinc/cp-zookeeper
        restart: always
        ports:
            - "2181:2181"
        environment:
            zk_id: "1"
            ZOOKEEPER_CLIENT_PORT: 2181
            ZOOKEEPER_TICK_TIME: 2000
            ZOOKEEPER_SYNC_LIMIT: 2
  
  
    kafka:
        image: confluentinc/cp-kafka
        restart: always
        depends_on:
            - zookeeper
        ports:
            - "29092:29092"
        environment:
            KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
            KAFKA_ADVERTISED_LISTENERS: INTERNAL://kafka:9092,OUTSIDE://localhost:29092
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:PLAINTEXT,OUTSIDE:PLAINTEXT
            KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
            KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: "1"
            
    postgres:
        image: postgres
        restart: always
        ports:
            - "5432:5432"
        environment: 
            POSTGRES_USER: "postgres"
            POSTGRES_PASSWORD: "postgres"
            POSTGRES_DB: "postgres"
        volumes:
            - ./db:/docker-entrypoint-initdb.d/

    prometheus:
        image: prom/prometheus
        ports:
            - "9090:9090"
        volumes:
            - "./prometheus.yml:/etc/prometheus/prometheus.yml"

    jaeger:
        image: jaegertracing/all-in-one:latest
        ports:
            - "6831:6831/udp"
            - "16686:16686"
            
